<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaCare Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #10B981; border-radius: 4px; }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">

    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 bg-[#0F172A] text-white flex flex-col hidden md:flex">
            <div class="p-6 flex items-center gap-3">
                <div class="bg-green-500 p-2 rounded-lg">
                    <i class="fas fa-first-aid text-white"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg">PharmaCare</h1>
                    <p class="text-xs text-gray-400">Inventory v1.0</p>
                </div>
            </div>

            <nav class="flex-1 px-4 space-y-2 mt-4">
                <a href="#" onclick="showSection('inventory')" class="flex items-center gap-3 px-4 py-3 bg-green-600 rounded-lg text-white transition">
                    <i class="fas fa-box"></i> Inventory
                </a>
                <a href="#" onclick="showSection('expired')" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg transition">
                    <i class="fas fa-exclamation-triangle"></i> Expired / Low
                </a>
            </nav>

            <div class="p-4 border-t border-gray-700">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold">JD</div>
                    <div>
                        <p class="text-sm font-bold">Admin</p>
                        <p class="text-xs text-gray-400">Pharmacist</p>
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col h-full overflow-hidden">
            
            <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 shadow-sm z-10">
                <div class="flex items-center bg-gray-100 rounded-lg px-3 py-2 w-96">
                    <i class="fas fa-search text-gray-400"></i>
                    <input type="text" id="searchInput" placeholder="Search by brand name or generic..." class="bg-transparent border-none outline-none ml-2 w-full text-sm">
                </div>
                <button onclick="openModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition shadow-lg">
                    <i class="fas fa-plus"></i> Add Medicine
                </button>
            </header>

            <div class="flex-1 overflow-auto p-6 relative">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Inventory Management</h2>
                        <p class="text-gray-500 text-sm mt-1" id="totalCount">Loading items...</p>
                    </div>
                    
                    <select id="filterCategory" class="bg-white border border-gray-300 text-gray-700 text-sm rounded-lg p-2.5 outline-none focus:border-green-500">
                        <option value="All">All Categories</option>
                        <option value="Tablet">Tablet</option>
                        <option value="Capsule">Capsule</option>
                        <option value="Syrup">Syrup</option>
                        <option value="Injection">Injection</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div id="inventoryGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20">
                    </div>
            </div>
        </main>
    </div>

    <div id="medicineModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden transform transition-all scale-100">
            <div class="bg-gray-50 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-bold text-gray-800" id="modalTitle">Add New Medicine</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-red-500"><i class="fas fa-times"></i></button>
            </div>
            
            <form id="medicineForm" onsubmit="saveMedicine(event)" class="p-6 space-y-4 max-h-[80vh] overflow-y-auto">
                <input type="hidden" id="medicineId">
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Brand Name</label>
                        <input type="text" id="name" required class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-green-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Formula (Generic)</label>
                        <input type="text" id="formula" required class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-green-500 outline-none">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Category</label>
                        <select id="category" class="w-full border border-gray-300 rounded-lg p-2">
                            <option>Tablet</option>
                            <option>Capsule</option>
                            <option>Syrup</option>
                            <option>Injection</option>
                            <option>Ointment</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Location (Rack)</label>
                        <input type="text" id="location" placeholder="e.g. A-12" class="w-full border border-gray-300 rounded-lg p-2">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Price (PKR)</label>
                        <input type="number" id="price" required class="w-full border border-gray-300 rounded-lg p-2">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Stock Quantity</label>
                        <input type="number" id="stock" required class="w-full border border-gray-300 rounded-lg p-2">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Expiry Date</label>
                    <input type="date" id="expiry" required class="w-full border border-gray-300 rounded-lg p-2">
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Medicine Image</label>
                    <div class="flex items-center gap-2">
                        <input type="file" id="imageInput" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100">
                    </div>
                    <p class="text-xs text-gray-400 mt-1">Leave empty to use default icon.</p>
                </div>

                <div class="pt-4 flex gap-3">
                    <button type="button" onclick="closeModal()" class="w-full py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition">Cancel</button>
                    <button type="submit" class="w-full py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition">Save Medicine</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- 1. DATA MANAGEMENT ---
        let inventory = JSON.parse(localStorage.getItem('pharmacyData')) || [
            { id: 1, name: 'Panadol Extra', formula: 'Paracetamol', category: 'Tablet', location: 'B-05', price: 50, stock: 45, expiry: '2024-10-15', image: null },
            { id: 2, name: 'Amoxicillin', formula: 'Amoxicillin', category: 'Capsule', location: 'A-12', price: 250, stock: 150, expiry: '2025-12-01', image: null },
            { id: 3, name: 'Brufen', formula: 'Ibuprofen', category: 'Syrup', location: 'B-08', price: 120, stock: 10, expiry: '2026-05-20', image: null }
        ];

        // --- 2. RENDER FUNCTIONS ---
        const grid = document.getElementById('inventoryGrid');
        const countLabel = document.getElementById('totalCount');
        
        function renderInventory(data = inventory) {
            grid.innerHTML = '';
            countLabel.innerText = `Showing ${data.length} items`;

            data.forEach(item => {
                // Calculate Status
                const expiryDate = new Date(item.expiry);
                const today = new Date();
                const isExpired = expiryDate < today;
                const isLowStock = item.stock < 20;
                
                let badge = '';
                if(isExpired) badge = `<span class="px-2 py-1 text-xs font-bold bg-red-100 text-red-600 rounded">Expired</span>`;
                else if(isLowStock) badge = `<span class="px-2 py-1 text-xs font-bold bg-orange-100 text-orange-600 rounded">Low Stock</span>`;
                else badge = `<span class="px-2 py-1 text-xs font-bold bg-green-100 text-green-600 rounded">In Stock</span>`;

                // Image logic
                const imgDisplay = item.image 
                    ? `<img src="${item.image}" class="w-12 h-12 rounded object-cover">` 
                    : `<div class="w-12 h-12 rounded bg-blue-50 flex items-center justify-center text-blue-500"><i class="fas fa-pills text-xl"></i></div>`;

                const card = `
                <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition group relative">
                    <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition">
                        <button onclick="editMedicine(${item.id})" class="text-blue-500 hover:bg-blue-50 p-1 rounded"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteMedicine(${item.id})" class="text-red-500 hover:bg-red-50 p-1 rounded"><i class="fas fa-trash"></i></button>
                    </div>

                    <div class="flex items-start gap-4 mb-4">
                        ${imgDisplay}
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">${item.name}</h3>
                            <p class="text-gray-500 text-sm">${item.formula}</p>
                            <div class="mt-2 flex gap-2">
                                ${badge}
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-y-3 text-sm bg-gray-50 p-3 rounded-lg">
                        <div>
                            <p class="text-xs text-gray-400 uppercase">Category</p>
                            <p class="font-medium text-gray-700">${item.category}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-400 uppercase">Location</p>
                            <p class="font-medium text-gray-700">${item.location}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-400 uppercase">Price</p>
                            <p class="font-bold text-green-600">Rs. ${item.price}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-400 uppercase">Expiry</p>
                            <p class="font-medium text-red-500">${item.expiry}</p>
                        </div>
                    </div>

                    <div class="mt-4 flex items-center justify-between">
                        <p class="text-xs font-bold text-gray-400">Stock Level</p>
                        <div class="flex items-center gap-3">
                            <button onclick="updateStock(${item.id}, -1)" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 font-bold">-</button>
                            <span class="w-8 text-center font-bold text-gray-800">${item.stock}</span>
                            <button onclick="updateStock(${item.id}, 1)" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 font-bold">+</button>
                        </div>
                    </div>
                </div>`;
                grid.innerHTML += card;
            });
        }

        // --- 3. ADD / EDIT LOGIC ---
        const modal = document.getElementById('medicineModal');
        let isEditing = false;

        function openModal() {
            document.getElementById('medicineForm').reset();
            document.getElementById('medicineId').value = '';
            document.getElementById('modalTitle').innerText = 'Add New Medicine';
            isEditing = false;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        function editMedicine(id) {
            const item = inventory.find(i => i.id === id);
            if(!item) return;

            document.getElementById('medicineId').value = item.id;
            document.getElementById('name').value = item.name;
            document.getElementById('formula').value = item.formula;
            document.getElementById('category').value = item.category;
            document.getElementById('location').value = item.location;
            document.getElementById('price').value = item.price;
            document.getElementById('stock').value = item.stock;
            document.getElementById('expiry').value = item.expiry;
            
            document.getElementById('modalTitle').innerText = 'Edit Medicine';
            isEditing = true;
            modal.classList.remove('hidden');
        }

        function saveMedicine(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('imageInput');
            const id = document.getElementById('medicineId').value;
            const name = document.getElementById('name').value;
            // ... collect other values ...

            // Handle Image (Convert to Base64)
            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    processSave(e.target.result);
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                // Keep old image if editing, or null if new
                const oldItem = inventory.find(i => i.id == id);
                processSave(oldItem ? oldItem.image : null);
            }
        }

        function processSave(imageBase64) {
            const id = document.getElementById('medicineId').value;
            const newItem = {
                id: id ? parseInt(id) : Date.now(), // Generate ID if new
                name: document.getElementById('name').value,
                formula: document.getElementById('formula').value,
                category: document.getElementById('category').value,
                location: document.getElementById('location').value,
                price: document.getElementById('price').value,
                stock: parseInt(document.getElementById('stock').value),
                expiry: document.getElementById('expiry').value,
                image: imageBase64
            };

            if (isEditing) {
                const index = inventory.findIndex(i => i.id == id);
                inventory[index] = newItem;
            } else {
                inventory.push(newItem);
            }

            localStorage.setItem('pharmacyData', JSON.stringify(inventory));
            closeModal();
            renderInventory();
            updateStats();
        }

        function deleteMedicine(id) {
            if(confirm('Are you sure you want to delete this medicine?')) {
                inventory = inventory.filter(i => i.id !== id);
                localStorage.setItem('pharmacyData', JSON.stringify(inventory));
                renderInventory();
            }
        }

        function updateStock(id, change) {
            const item = inventory.find(i => i.id === id);
            if(item) {
                item.stock += change;
                if(item.stock < 0) item.stock = 0;
                localStorage.setItem('pharmacyData', JSON.stringify(inventory));
                renderInventory();
            }
        }

        // --- 4. SEARCH & FILTER ---
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = inventory.filter(item => 
                item.name.toLowerCase().includes(term) || 
                item.formula.toLowerCase().includes(term)
            );
            renderInventory(filtered);
        });

        document.getElementById('filterCategory').addEventListener('change', (e) => {
            const cat = e.target.value;
            if(cat === 'All') renderInventory(inventory);
            else {
                const filtered = inventory.filter(item => item.category === cat);
                renderInventory(filtered);
            }
        });

        // Initialize
        renderInventory();
    </script>
</body>
</html>