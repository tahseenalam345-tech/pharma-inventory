<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alazamat Medical Store - v7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #0f172a; color: white; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #0ea5e9; border-radius: 4px; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-enter { animation: fadeIn 1s ease-out forwards; }
        
        /* Sidebar Transition */
        .sidebar-transition { transition: transform 0.3s ease-in-out; }

        /* --- PRINT SETTINGS (FIXED) --- */
        @media print {
            @page { margin: 0; size: auto; }
            body * { visibility: hidden; height: 0; overflow: hidden; }
            #receiptArea, #receiptArea * { visibility: visible; height: auto; overflow: visible; }
            #receiptArea { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 72mm; /* Standard Thermal Width */
                padding: 10px;
                background: white; 
                color: black !important;
                font-family: 'Courier New', monospace;
            }
            /* Hide Buttons in Print Mode */
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside id="sidebar" class="w-64 bg-slate-900 border-r border-slate-800 flex-col hidden md:flex z-50">
        <div class="p-6 flex items-center gap-3 border-b border-slate-800">
            <i class="fas fa-clinic-medical text-emerald-400 text-2xl"></i>
            <div>
                <h1 class="font-bold text-lg tracking-wide text-white">Alazamat</h1>
                <p class="text-xs text-slate-400">Medical Store</p>
            </div>
        </div>
        
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <button onclick="showSection('hero')" class="nav-item w-full text-left p-3 rounded-xl hover:bg-slate-800 text-slate-300 hover:text-white flex items-center gap-3 transition">
                <i class="fas fa-home text-sky-400"></i> Home
            </button>
            <button onclick="showSection('inventory')" class="nav-item w-full text-left p-3 rounded-xl hover:bg-slate-800 text-slate-300 hover:text-white flex items-center gap-3 transition">
                <i class="fas fa-pills text-emerald-400"></i> Medicines
            </button>
            <button onclick="showSection('history')" class="nav-item w-full text-left p-3 rounded-xl hover:bg-slate-800 text-slate-300 hover:text-white flex items-center gap-3 transition">
                <i class="fas fa-history text-yellow-400"></i> Sales History
            </button>
            <button onclick="showSection('purchases')" class="nav-item w-full text-left p-3 rounded-xl hover:bg-slate-800 text-slate-300 hover:text-white flex items-center gap-3 transition">
                <i class="fas fa-truck text-purple-400"></i> Buying Records
            </button>
            <button onclick="showSection('reports')" class="nav-item w-full text-left p-3 rounded-xl hover:bg-slate-800 text-slate-300 hover:text-white flex items-center gap-3 transition">
                <i class="fas fa-chart-line text-red-400"></i> Profit Report
            </button>
        </nav>

        <div class="p-4 border-t border-slate-800">
            <p class="text-xs font-bold text-slate-500 uppercase mb-2">System</p>
            <button onclick="downloadBackup()" class="text-xs text-sky-400 hover:underline mb-1 block">Save Backup (PC)</button>
            <label class="text-xs text-sky-400 hover:underline cursor-pointer">
                Restore Backup
                <input type="file" class="hidden" onchange="restoreBackup(this)">
            </label>
        </div>
    </aside>

    <button onclick="document.getElementById('mobileMenu').classList.toggle('hidden')" class="md:hidden fixed top-4 right-4 z-50 bg-slate-800 p-2 rounded text-white">
        <i class="fas fa-bars"></i>
    </button>
    <div id="mobileMenu" class="fixed inset-0 bg-slate-900 z-40 hidden flex flex-col p-8 md:hidden">
        <button onclick="document.getElementById('mobileMenu').classList.add('hidden')" class="self-end text-white text-2xl mb-8"><i class="fas fa-times"></i></button>
        <button onclick="showSection('hero'); toggleMobile()" class="text-xl text-white mb-4">Home</button>
        <button onclick="showSection('inventory'); toggleMobile()" class="text-xl text-white mb-4">Medicines</button>
        <button onclick="showSection('history'); toggleMobile()" class="text-xl text-white mb-4">History</button>
        <button onclick="showSection('purchases'); toggleMobile()" class="text-xl text-white mb-4">Purchases</button>
        <button onclick="showSection('reports'); toggleMobile()" class="text-xl text-white mb-4">Reports</button>
    </div>

    <main class="flex-1 overflow-hidden relative bg-slate-950">
        
        <section id="hero" class="content-section h-full overflow-y-auto flex flex-col items-center justify-center relative">
            <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-800 via-slate-950 to-black z-0"></div>
            
            <div class="z-10 text-center animate-enter p-6">
                <div class="relative group mx-auto w-32 h-32 mb-6">
                    <img id="storeLogoDisplay" src="https://via.placeholder.com/150?text=LOGO" class="w-32 h-32 rounded-full border-4 border-emerald-500 object-cover shadow-2xl shadow-emerald-500/20">
                    <label class="absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 cursor-pointer transition">
                        <span class="text-xs text-white font-bold">Change Logo</span>
                        <input type="file" class="hidden" accept="image/*" onchange="uploadLogo(this)">
                    </label>
                </div>

                <h1 class="text-5xl md:text-7xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-sky-400 mb-2">Alazamat</h1>
                <h2 class="text-2xl md:text-3xl font-light text-slate-300 tracking-[0.3em] uppercase mb-8">Medical Store</h2>
                
                <button onclick="showSection('inventory')" class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-bold px-8 py-4 rounded-full text-lg shadow-lg shadow-emerald-500/30 transition transform hover:scale-105">
                    Open Inventory
                </button>
            </div>
        </section>

        <section id="inventory" class="content-section h-full flex flex-col hidden bg-slate-900">
            <header class="p-6 border-b border-slate-800 flex flex-col md:flex-row justify-between items-center gap-4 bg-slate-900 z-10">
                <h2 class="text-2xl font-bold text-white"><i class="fas fa-pills text-emerald-400 mr-2"></i> Medicines</h2>
                <div class="flex w-full md:w-auto gap-2">
                    <input type="text" id="searchInput" placeholder="Search name, brand..." class="flex-1 bg-slate-800 border border-slate-700 text-white px-4 py-2 rounded-lg outline-none focus:border-emerald-500">
                    <button onclick="openModal('medModal')" class="bg-emerald-500 text-black px-4 py-2 rounded-lg font-bold hover:bg-emerald-400">+ Add</button>
                </div>
            </header>
            
            <div id="inventoryGrid" class="flex-1 overflow-y-auto p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 content-start">
                </div>
        </section>

        <section id="history" class="content-section h-full flex flex-col hidden bg-slate-900">
            <header class="p-6 border-b border-slate-800 bg-slate-900">
                <h2 class="text-2xl font-bold text-white"><i class="fas fa-history text-yellow-400 mr-2"></i> Sales History</h2>
            </header>
            <div class="flex-1 overflow-y-auto p-6">
                <table class="w-full text-left text-slate-300">
                    <thead class="bg-slate-800 text-xs uppercase text-slate-500">
                        <tr><th class="p-4">Date</th><th class="p-4">Item</th><th class="p-4">Qty</th><th class="p-4 text-right">Total</th><th class="p-4 text-center">Receipt</th></tr>
                    </thead>
                    <tbody id="historyTable" class="divide-y divide-slate-800"></tbody>
                </table>
            </div>
        </section>

        <section id="purchases" class="content-section h-full flex flex-col hidden bg-slate-900">
            <header class="p-6 border-b border-slate-800 flex justify-between items-center bg-slate-900">
                <h2 class="text-2xl font-bold text-white"><i class="fas fa-truck text-purple-400 mr-2"></i> Dealer Records</h2>
                <button onclick="openModal('purchaseModal')" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-400">Add Record</button>
            </header>
            <div id="purchaseGrid" class="flex-1 overflow-y-auto p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 content-start"></div>
        </section>

        <section id="reports" class="content-section h-full flex flex-col hidden bg-slate-900">
            <header class="p-6 border-b border-slate-800 bg-slate-900">
                <h2 class="text-2xl font-bold text-white"><i class="fas fa-chart-line text-red-400 mr-2"></i> Profit Report</h2>
            </header>
            <div class="p-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                        <p class="text-sm text-slate-400 uppercase">Total Sales Revenue</p>
                        <p class="text-3xl font-bold text-sky-400" id="repRev">0</p>
                    </div>
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                        <p class="text-sm text-slate-400 uppercase">Total Buying Cost</p>
                        <p class="text-3xl font-bold text-red-400" id="repCost">0</p>
                    </div>
                    <div class="bg-emerald-900/20 p-6 rounded-2xl border border-emerald-500/30">
                        <p class="text-sm text-emerald-400 uppercase font-bold">Net Profit</p>
                        <p class="text-4xl font-bold text-white mt-2" id="repProfit">0</p>
                    </div>
                </div>
            </div>
        </section>

    </main>


    <div id="medModal" class="fixed inset-0 bg-black/80 hidden z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-slate-800 w-full max-w-2xl rounded-2xl border border-slate-700 shadow-2xl flex flex-col max-h-[90vh]">
            <div class="p-5 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-xl font-bold text-white">Medicine Details</h3>
                <button onclick="closeModal('medModal')" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            <form onsubmit="saveMedicine(event)" class="p-6 space-y-4 overflow-y-auto custom-scrollbar">
                <input type="hidden" id="medId">
                
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="lbl">Name</label><input type="text" id="medName" required class="input"></div>
                    <div><label class="lbl">Brand</label><input type="text" id="medBrand" class="input"></div>
                </div>
                <div><label class="lbl">Formula</label><input type="text" id="medFormula" class="input"></div>

                <div class="bg-slate-700/50 p-4 rounded-xl border border-slate-600">
                    <p class="text-xs text-sky-400 uppercase font-bold mb-3">Stock & Packs</p>
                    <div class="grid grid-cols-3 gap-3">
                        <div><label class="lbl">Total Packs</label><input type="number" id="medTotalPacks" required class="input bg-slate-800" oninput="calcUnits()"></div>
                        <div><label class="lbl">Items per Pack</label><input type="number" id="medPackSize" value="1" required class="input bg-slate-800" oninput="calcUnits()"></div>
                        <div><label class="lbl">Total Units (Calc)</label><input type="number" id="medStock" readonly class="input bg-black/50 text-slate-400 cursor-not-allowed"></div>
                    </div>
                </div>

                <div class="bg-slate-700/50 p-4 rounded-xl border border-slate-600">
                    <p class="text-xs text-emerald-400 uppercase font-bold mb-3">Pricing (Per Pack)</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="lbl">Buying Cost</label><input type="number" id="medCost" required class="input bg-slate-800"></div>
                        <div><label class="lbl">Selling Price</label><input type="number" id="medPrice" required class="input bg-slate-800"></div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div><label class="lbl">Category</label><select id="medCat" class="input"><option>Tablet</option><option>Syrup</option><option>Injection</option><option>Capsule</option><option>Other</option></select></div>
                    <div><label class="lbl">Expiry</label><input type="date" id="medExp" class="input"></div>
                </div>
                <div><label class="lbl">Image</label><input type="file" id="medImg" accept="image/*" class="w-full text-sm text-slate-400"></div>

                <button class="w-full bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-bold py-3 rounded-xl">Save Medicine</button>
            </form>
        </div>
    </div>

    <div id="saleModal" class="fixed inset-0 bg-black/80 hidden z-[70] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-slate-800 w-full max-w-sm rounded-2xl border border-slate-700 shadow-2xl p-6 text-center">
            <h3 class="text-xl font-bold text-white mb-1" id="saleName">Name</h3>
            <p class="text-sm text-slate-400 mb-6" id="saleInfo">Info</p>

            <div class="flex justify-center items-center gap-4 mb-4">
                <button onclick="adjQty(-1)" class="w-10 h-10 rounded-full bg-slate-700 text-white">-</button>
                <input type="number" id="saleQty" value="1" class="w-20 bg-transparent text-3xl font-bold text-center text-white border-b-2 border-emerald-500 outline-none" oninput="calcTotal()">
                <button onclick="adjQty(1)" class="w-10 h-10 rounded-full bg-slate-700 text-white">+</button>
            </div>
            <p class="text-xs text-slate-500 mb-4">Quantity in Units (Tablets)</p>

            <div class="mb-4 text-left">
                <label class="lbl">Discount (Rs)</label>
                <input type="number" id="saleDisc" placeholder="0" class="input" oninput="calcTotal()">
            </div>
